"use strict";define(["module-directive-bundling-user-all","module-services-api"],function(a,b){var c=angular.module("myApp",["pascalprecht.translate","ui.router","ui.bootstrap","ngAnimate"]);c.controller("EditController",["$scope","$http","$q","$location","$state","$translate","doctorDiagnosisServices","sysICDsServices","sysDrugsServices","userMembersServices","drugstoreServices",function(a,c,d,e,f,g,h,i,j,k,l){a.MemberID="",a.MemberName="",a.MemberGenderName="",a.Age="",a.DoctorID="",a.DoctorName="";var m={N0:"未提交",N1:"已提交",N2:"医生已保存",N3:"已提交签名",N4:"已开处方"},n={N0:"新增",N1:"保存",N2:"提交",N3:"提交签名",N4:"开处方",N5:"驳回"},o={N0:"男",N1:"女",N2:"其他"};a.DrugstoreRecipeID=f.params.id,a.DrugstoreRecipeStatus=0,a.StatusName="",a.DrugstoreRecipe={},a.DrugSellDate="";var p={"中药处方":1,"西药处方":2};a.doseUnitEN=["片","粒","袋","ml","g","丸","支","瓶","盒","mg","克","包","kg","合","贴","罐","条","台","个","卷","只","套","提","枚","扎","小盒","板","对","付","根","块","斤","小丸","小包","小袋","排","塑瓶"],a.doseUnitCN=["g","克","片","瓶","kg","粒","袋","包","条","支","盒","个","根","对","10G","丸","扎"],a.drugFrequency=[{shade:"QD",name:"QD 每日一次"},{shade:"BID",name:"BID 每日两次"},{shade:"TID",name:"TID 每日三次"},{shade:"QID",name:"QID 每日四次"},{shade:"ST.",name:"ST. 立即"},{shade:"连续",name:"连续"},{shade:"HS",name:"HS 睡前"},{shade:"SOS",name:"SOS 需要时"},{shade:"PRN",name:"PRN 必要时"},{shade:"Q1/2H",name:"Q1/2H 半小时一次"},{shade:"Qn",name:"Qn 每小时一次"},{shade:"Q2H",name:"Q2H 2小时一次"},{shade:"Q3H",name:"Q3H 3小时一次"},{shade:"Q4h",name:"Q4h 4小时一次"},{shade:"Q6h",name:"Q6h 6小时一次"},{shade:"Q8h",name:"Q8h 8小时一次"},{shade:"Q12h",name:"Q12h 12小时一次"},{shade:"QM",name:"QM 早晨一次"},{shade:"QN",name:"QN 晚上一次"},{shade:"QW",name:"QW 每周一次"},{shade:"BIW",name:"BIW 每周二次"},{shade:"QOD",name:"QOD 隔日一次"},{shade:"Q3D",name:"Q3D 3天一次"},{shade:"Q4D",name:"Q4D 4天一次"},{shade:"Q5D",name:"Q5D 5天一次"}],a.drugRoteItems=[{shade:"口服"},{shade:"含服"},{shade:"煎服"},{shade:"外用加棉签"},{shade:"舌下含服"},{shade:"眼用"},{shade:"滴耳"},{shade:"吸入"},{shade:"滴鼻"},{shade:"含漱"},{shade:"外用"},{shade:"喷喉"},{shade:"吸氧"},{shade:"吸痰"},{shade:"雾化吸入"},{shade:"涂口腔"},{shade:"塞肛"},{shade:"阴道给药"},{shade:"洗口腔"}],a.OPDRegisterID=0,a.Sympton="",a.Disease="",a.PhysicalExam=[{ItemCode:"BloodPressure",ItemCNName:"血压",ItemENName:"BloodPressure",Result:"",RefRange:"",Unit:"mmHg",Value:"1"},{ItemCode:"Breathe",ItemCNName:"呼吸",ItemENName:"Breathe",Result:"",RefRange:"",Unit:"次/分",Value:"2"},{ItemCode:"GLU",ItemCNName:"空腹血糖",ItemENName:"GLU",Result:"",RefRange:"",Unit:"mmol/L",$$hashKey:"object:261"},{ItemCode:"HeartRate",ItemCNName:"心率",ItemENName:"HeartRate",Result:"",RefRange:"",Unit:"次/分"},{ItemCode:"Height",ItemCNName:"身高",ItemENName:"Height",Result:"",RefRange:"",Unit:"cm"},{ItemCode:"PBG",ItemCNName:"餐后血糖",ItemENName:"PBG",Result:"",RefRange:"",Unit:"mmol/L"},{ItemCode:"TC",ItemCNName:"总胆固醇",ItemENName:"TC",Result:"",RefRange:"",Unit:"mmol/L"},{ItemCode:"Temperature",ItemCNName:"体温",ItemENName:"Temperature",Result:"",RefRange:"",Unit:"℃"},{ItemCode:"Waistline",ItemCNName:"腰围",ItemENName:"Waistline",Result:"",RefRange:"",Unit:"cm"},{ItemCode:"Weight",ItemCNName:"体重",ItemENName:"Weight",Result:"",RefRange:"",Unit:"kg"}],a.RecipeFiles=[],a.Doctors=[],a.RecipeHis=[],a.onLoad=function(){var b=layer.load(0,{shade:[.1,"#000"]});a.DrugstoreRecipeID.length>0&&l.getDrugstoreRecipe({DrugstoreRecipeID:a.DrugstoreRecipeID},function(c){a.RecipeFiles=c.Data.RecipeList,null!=c.Data.RecipeHis&&($.each(c.Data.RecipeHis,function(a,b){b.OpTypeName=n["N"+b.OpType]}),a.RecipeHis=c.Data.RecipeHis),a.DoctorID=c.Data.DoctorID,a.DoctorName=c.Data.Doctor.DoctorName,a.MemberID=c.Data.MemberID,a.MemberName=c.Data.UserMember.MemberName,a.DrugstoreRecipeStatus=c.Data.DrugstoreRecipeStatus,a.StatusName=m["N"+a.DrugstoreRecipeStatus],a.MemberGenderName=o["N"+c.Data.UserMember.Gender],a.Age=c.Data.UserMember.Age,a.DrugSellDate=c.Data.DrugSellDate,a.onShowRecipeFile(a.RecipeFiles[0]),a.RecipeFiles.length<2&&0==a.DrugstoreRecipeStatus&&("中药处方"==a.RecipeFiles[0].RecipeName&&a.onAddRecipeFile(!1,!1),"西药处方"==a.RecipeFiles[0].RecipeName&&a.onAddRecipeFile(!0,!1)),layer.close(b)},function(){layer.close(b),layer.msg("加载会员处方失败")})},a.getUserMember=function(b){if(a.GetStringLength($.trim(b))>1){var c=d.defer();return k.query({Keyword:b,PageSize:65535,CurrentPage:1},function(a){a.Data.map(function(a){return a}),c.resolve(a.Data)},function(){c.reject([])}),c.promise}},a.onUserMemberSelect=function(b,c,d){a.MemberID=b.MemberID,a.MemberName=b.MemberName,a.MemberGenderName=o["N"+b.Gender],a.Age=b.Age},a.getDoctor=function(b){l.getDrugstoreDoctors({Keyword:b,PageSize:65535,CurrentPage:1},function(b){a.Doctors=b.Data})},a.getDoctor(),a.onAddRecipeFile=function(b,c){a.RecipeFiles.length;b?a.RecipeFiles.push({Details:[],RecipeName:"中药处方",Usage:"",TCMQuantity:1,RecipeType:p.中药处方,Diagnoses:[],current:c}):a.RecipeFiles.push({Details:[],RecipeName:"西药处方",Usage:"",TCMQuantity:1,RecipeType:p.西药处方,Diagnoses:[],current:c})},a.onShowRecipeFile=function(b){for(var c=0;c<a.RecipeFiles.length;c++)a.RecipeFiles[c].current=!1;b.current=!0},a.onAddICDRecord=function(a){a.Diagnoses.push({Detail:{ID:0,DiseaseCode:"",DiseaseName:""},Description:""})},a.onRemoveICDRecord=function(b,c){var d=layer.confirm("确认删除吗？",{btn:["确认","取消"]},function(){var e=b.Diagnoses.indexOf(c);b.Diagnoses.splice(e,1),a.$apply(),layer.close(d)},function(){})},a.getICDRecords=function(b,c){if(a.GetStringLength($.trim(b))>1){var e=d.defer();return i.get({Keyword:b,ICDType:c},function(a){a.Data.map(function(a){return a}),e.resolve(a.Data)},function(){e.reject([])}),e.promise}},a.onDiseaseSelect=function(a,b,c){a.Detail=b,a.Detail.Description=b.DiseaseName,a.Detail.DiagnoseType=b.ICDType},a.onAddDrugDetail=function(){var b=a.RecipeFiles;if(b.length>0)for(var c=0;c<b.length;c++)b[c].current&&b[c].Details.push({Dose:1,Quantity:1,DrugRouteName:"",Frequency:"",DoseUnit:"",Unit:"",Drug:{DrugID:"",DrugCode:"",DrugName:"",Specification:"",DoseUnit:"",UnitPrice:"",TotalDose:0,Unit:""}})},a.onRemoveDrugDetail=function(b,c){var d=layer.confirm("确认删除吗？",{btn:["确认","取消"]},function(){var e=c.Details.indexOf(b);c.Details.splice(e,1),layer.close(d),a.$apply()},function(){})},a.loginInfo=b.getLoginInfo(),a.getDrugDetails=function(b,c){if(a.GetStringLength($.trim(b))>1){var e=d.defer();return j.get({Keyword:b,DrugType:c,UserID:a.loginInfo.UserID},function(a){a.Data.map(function(a){return a}),e.resolve(a.Data)},function(){e.reject([])}),e.promise}},a.onDrugSelect=function(a,b,c){a.Quantity=1,a.Dose=a.Quantity*a.TotalDose},a.formatDrugItem=function(b){return void 0==b?" ":a.flag?(a.flag=!1,b.DrugName):b.ID==-1?b.DrugName:void 0==b.FactoryName?b.DrugName:b.DrugName+" ("+b.Specification.trim()+"/"+b.Unit+") ("+b.FactoryName+")"},a.GetStringLength=function(a){for(var b=0,c="",d=0;d<a.length;d++)c=a.charCodeAt(d),b+=c>=0&&c<=128?1:2;return b},a.getNoEmpty=function(){var b=a.RecipeFiles,c=[];if(b.length>0)for(var d=0;d<b.length;d++)b[d].Details.length>0&&c.push(b[d]);return c},a.onSubmit=function(b){if($("#myForm").valid()){if(a.MemberID.length<=0)return void layer.msg('会员信息必须是在"我的会员"中的数据');var c=a.getNoEmpty();if(void 0==c||null==c||c.length<=0)return void layer.msg("没有处方信息");for(var d=0;d<c.length;d++){var e=c[d];if(e.Diagnoses&&e.Diagnoses.length>0)for(var f=0;f<e.Diagnoses.length;f++)e.Diagnoses[f].Detail.DiseaseName.length>0&&e.Diagnoses[f].Detail.DiseaseCode<=0&&(e.Diagnoses[f].Detail.DiseaseCode="-")}a.DrugSellDate=$("#DrugSellDate").val();var h=layer.load(0,{shade:[.1,"#000"]});a.DrugstoreRecipeID.length>0?l.updateDrugstoreRecipe({DoctorID:a.DoctorID,MemberID:a.MemberID,DrugstoreRecipeID:a.DrugstoreRecipeID,DrugstoreRecipeStatus:b,DrugSellDate:a.DrugSellDate,RecipeFileDTOs:c},function(c){layer.close(h),c.Data.length>0?(a.DrugstoreRecipeStatus=b,a.DrugstoreRecipeID=c.Data,a.StatusName=m["N"+a.DrugstoreRecipeStatus],1==a.DrugstoreRecipeStatus?layer.msg("提交成功"):layer.msg(g.instant("msgSaveSuccess")),a.onLoad()):layer.msg(g.instant("msgSaveFail"),{icon:2,shade:.5})},function(){layer.close(h),layer.msg(g.instant("msgSaveFail"),{icon:2,shade:.5})}):l.insertDrugstoreRecipe({DoctorID:a.DoctorID,MemberID:a.MemberID,DrugstoreRecipeStatus:b,DrugSellDate:a.DrugSellDate,RecipeFileDTOs:c},function(c){layer.close(h),c.Data.length>0?(a.DrugstoreRecipeStatus=b,a.DrugstoreRecipeID=c.Data,a.StatusName=m["N"+a.DrugstoreRecipeStatus],1==a.DrugstoreRecipeStatus?layer.msg("提交成功"):layer.msg(g.instant("msgSaveSuccess")),a.onLoad()):layer.msg(g.instant("msgSaveFail"),{icon:2,shade:.5})},function(){layer.close(h),layer.msg(g.instant("msgSaveFail"),{icon:2,shade:.5})})}},a.$on("CopiedPatientVisitRecord",function(b,c){a.Sympton=c.HistoryRegister.Sympton,a.PastMedicalHistory=c.HistoryRegister.PastMedicalHistory,a.PresentHistoryIllness=c.HistoryRegister.PresentHistoryIllness,a.PhysicalExam=c.HistoryRegister.PhysicalExam;for(var d=0;d<c.HistoryRecordDetail.RecipeList.length;d++){for(var e=c.HistoryRecordDetail.RecipeList[d].ID,f=!0,h=0;h<a.RecipeFiles.length;h++)a.RecipeFiles[h].ID==e&&(f=!1);f&&a.RecipeFiles.push(c.HistoryRecordDetail.RecipeList[d])}layer.msg(g.instant("msgCopySuccess")),$("#dialog-patient_record").modal("hide")}),a.GoBack=function(){history.back()},a.DrugstoreRecipeID?($("#ptitle").html("编辑处方"),a.onLoad()):($("#ptitle").html("添加处方"),a.onAddRecipeFile(!1,!0),a.onAddRecipeFile(!0,!1))}])});
//# sourceMappingURL=EditController.min.js.map
/*! 康美网络医院 最后修改于： 2017-01-13 */