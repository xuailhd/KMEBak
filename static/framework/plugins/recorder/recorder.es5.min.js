"use strict";(function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.Recorder=n()}})(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){t.exports=n("./recorder").Recorder},{"./recorder":2}],2:[function(n,t,i){function o(n){return n&&n.__esModule?n:{"default":n}}function s(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var e=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),r,u,f;Object.defineProperty(i,"__esModule",{value:!0});i.Recorder=undefined;r=n("inline-worker");u=o(r);f=i.Recorder=function(){function n(t,i){var f=this,r;s(this,n);this.config={bufferLen:4096,numChannels:2,mimeType:"audio/wav"};this.recording=!1;this.callbacks={getBuffer:[],exportWAV:[]};Object.assign(this.config,i);this.context=t.context;this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels);this.node.onaudioprocess=function(n){var i,t;if(f.recording){for(i=[],t=0;t<f.config.numChannels;t++)i.push(n.inputBuffer.getChannelData(t));f.worker.postMessage({command:"record",buffer:i})}};t.connect(this.node);this.node.connect(this.context.destination);r={};this.worker=new u["default"](function(){function s(t){f=t.sampleRate;n=t.numChannels;e()}function h(r){for(var u=0;u<n;u++)t[u].push(r[u]);i+=r[0].length}function c(u){for(var s,h,c,f=[],e=0;e<n;e++)f.push(o(t[e],i));s=undefined;s=n===2?v(f[0],f[1]):f[0];h=p(s);c=new Blob([h],{type:u});r.postMessage({command:"exportWAV",data:c})}function l(){for(var f=[],u=0;u<n;u++)f.push(o(t[u],i));r.postMessage({command:"getBuffer",data:f})}function a(){i=0;t=[];e()}function e(){for(var i=0;i<n;i++)t[i]=[]}function o(n,t){for(var r=new Float32Array(t),u=0,i=0;i<n.length;i++)r.set(n[i],u),u+=n[i].length;return r}function v(n,t){for(var f=n.length+t.length,i=new Float32Array(f),r=0,u=0;r<f;)i[r++]=n[u],i[r++]=t[u],u++;return i}function y(n,t,i){for(var u,r=0;r<i.length;r++,t+=2)u=Math.max(-1,Math.min(1,i[r])),n.setInt16(t,u<0?u*32768:u*32767,!0)}function u(n,t,i){for(var r=0;r<i.length;r++)n.setUint8(t+r,i.charCodeAt(r))}function p(t){var r=new ArrayBuffer(44+t.length*2),i=new DataView(r);return u(i,0,"RIFF"),i.setUint32(4,36+t.length*2,!0),u(i,8,"WAVE"),u(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,n,!0),i.setUint32(24,f,!0),i.setUint32(28,f*4,!0),i.setUint16(32,n*2,!0),i.setUint16(34,16,!0),u(i,36,"data"),i.setUint32(40,t.length*2,!0),y(i,44,t),i}var i=0,t=[],f=undefined,n=undefined;r.onmessage=function(n){switch(n.data.command){case"init":s(n.data.config);break;case"record":h(n.data.buffer);break;case"exportWAV":c(n.data.type);break;case"getBuffer":l();break;case"clear":a()}}},r);this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}});this.worker.onmessage=function(n){var t=f.callbacks[n.data.command].pop();typeof t=="function"&&t(n.data.data)}}return e(n,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(n){if(n=n||this.config.callback,!n)throw new Error("Callback not set");this.callbacks.getBuffer.push(n);this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(n,t){if(t=t||this.config.mimeType,n=n||this.config.callback,!n)throw new Error("Callback not set");this.callbacks.exportWAV.push(n);this.worker.postMessage({command:"exportWAV",type:t})}}],[{key:"forceDownload",value:function(n,t){var u=(window.URL||window.webkitURL).createObjectURL(n),i=window.document.createElement("a"),r;i.href=u;i.download=t||"output.wav";r=document.createEvent("Event");r.initEvent("click",!0,!0);i.dispatchEvent(r)}}]),n}();i["default"]=f},{"inline-worker":3}],3:[function(n,t){t.exports=n("./inline-worker")},{"./inline-worker":4}],4:[function(n,t){(function(n){var i=function(){function n(n,t){var r,i;for(r in t)i=t[r],i.configurable=!0,i.value&&(i.writable=!0);Object.defineProperties(n,t)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),r=function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");},u=!!(n===n.window&&n.URL&&n.Blob&&n.Worker),f=function(){function t(i,f){var s=this,e,o;if(r(this,t),u)return e=i.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],o=n.URL.createObjectURL(new n.Blob([e],{type:"text/javascript"})),new n.Worker(o);this.self=f;this.self.postMessage=function(n){setTimeout(function(){s.onmessage({data:n})},0)};setTimeout(function(){i.call(f)},0)}return i(t,{postMessage:{value:function(n){var t=this;setTimeout(function(){t.self.onmessage({data:n})},0)}}}),t}();t.exports=f}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[1])(1)});