"use strict";!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Recorder=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./recorder").Recorder},{"./recorder":2}],2:[function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0}),c.Recorder=void 0;var g=a("inline-worker"),h=d(g),i=c.Recorder=function(){function a(b,c){var d=this;e(this,a),this.config={bufferLen:4096,numChannels:2,mimeType:"audio/wav"},this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},Object.assign(this.config,c),this.context=b.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=function(a){if(d.recording){for(var b=[],c=0;c<d.config.numChannels;c++)b.push(a.inputBuffer.getChannelData(c));d.worker.postMessage({command:"record",buffer:b})}},b.connect(this.node),this.node.connect(this.context.destination);var f={};this.worker=new h.default(function(){function a(a){o=a.sampleRate,p=a.numChannels,g()}function b(a){for(var b=0;b<p;b++)n[b].push(a[b]);m+=a[0].length}function c(a){for(var b=[],c=0;c<p;c++)b.push(h(n[c],m));var d=void 0;d=2===p?i(b[0],b[1]):b[0];var e=l(d),g=new Blob([e],{type:a});f.postMessage({command:"exportWAV",data:g})}function d(){for(var a=[],b=0;b<p;b++)a.push(h(n[b],m));f.postMessage({command:"getBuffer",data:a})}function e(){m=0,n=[],g()}function g(){for(var a=0;a<p;a++)n[a]=[]}function h(a,b){for(var c=new Float32Array(b),d=0,e=0;e<a.length;e++)c.set(a[e],d),d+=a[e].length;return c}function i(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;e<c;)d[e++]=a[f],d[e++]=b[f],f++;return d}function j(a,b,c){for(var d=0;d<c.length;d++,b+=2){var e=Math.max(-1,Math.min(1,c[d]));a.setInt16(b,e<0?32768*e:32767*e,!0)}}function k(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}function l(a){var b=new ArrayBuffer(44+2*a.length),c=new DataView(b);return k(c,0,"RIFF"),c.setUint32(4,36+2*a.length,!0),k(c,8,"WAVE"),k(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,p,!0),c.setUint32(24,o,!0),c.setUint32(28,4*o,!0),c.setUint16(32,2*p,!0),c.setUint16(34,16,!0),k(c,36,"data"),c.setUint32(40,2*a.length,!0),j(c,44,a),c}var m=0,n=[],o=void 0,p=void 0;f.onmessage=function(f){switch(f.data.command){case"init":a(f.data.config);break;case"record":b(f.data.buffer);break;case"exportWAV":c(f.data.type);break;case"getBuffer":d();break;case"clear":e()}}},f),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(a){var b=d.callbacks[a.data.command].pop();"function"==typeof b&&b(a.data.data)}}return f(a,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(a){if(a=a||this.config.callback,!a)throw new Error("Callback not set");this.callbacks.getBuffer.push(a),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(a,b){if(b=b||this.config.mimeType,a=a||this.config.callback,!a)throw new Error("Callback not set");this.callbacks.exportWAV.push(a),this.worker.postMessage({command:"exportWAV",type:b})}}],[{key:"forceDownload",value:function(a,b){var c=(window.URL||window.webkitURL).createObjectURL(a),d=window.document.createElement("a");d.href=c,d.download=b||"output.wav";var e=document.createEvent("Event");e.initEvent("click",!0,!0),d.dispatchEvent(e)}}]),a}();c.default=i},{"inline-worker":3}],3:[function(a,b,c){b.exports=a("./inline-worker")},{"./inline-worker":4}],4:[function(a,b,c){(function(a){var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},e=!!(a===a.window&&a.URL&&a.Blob&&a.Worker),f=function(){function b(c,f){var g=this;if(d(this,b),e){var h=c.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],i=a.URL.createObjectURL(new a.Blob([h],{type:"text/javascript"}));return new a.Worker(i)}this.self=f,this.self.postMessage=function(a){setTimeout(function(){g.onmessage({data:a})},0)},setTimeout(function(){c.call(f)},0)}return c(b,{postMessage:{value:function(a){var b=this;setTimeout(function(){b.self.onmessage({data:a})},0)}}}),b}();b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Recorder=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./recorder").Recorder},{"./recorder":2}],2:[function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(c,"__esModule",{value:!0}),c.Recorder=void 0;var g=a("inline-worker"),h=d(g),i=c.Recorder=function(){function a(b,c){var d=this;e(this,a),this.config={bufferLen:4096,numChannels:2,mimeType:"audio/wav"},this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},Object.assign(this.config,c),this.context=b.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=function(a){if(d.recording){for(var b=[],c=0;c<d.config.numChannels;c++)b.push(a.inputBuffer.getChannelData(c));d.worker.postMessage({command:"record",buffer:b})}},b.connect(this.node),this.node.connect(this.context.destination);var f={};this.worker=new h.default(function(){function a(a){o=a.sampleRate,p=a.numChannels,g()}function b(a){for(var b=0;b<p;b++)n[b].push(a[b]);m+=a[0].length}function c(a){for(var b=[],c=0;c<p;c++)b.push(h(n[c],m));var d=void 0;d=2===p?i(b[0],b[1]):b[0];var e=l(d),g=new Blob([e],{type:a});f.postMessage({command:"exportWAV",data:g})}function d(){for(var a=[],b=0;b<p;b++)a.push(h(n[b],m));f.postMessage({command:"getBuffer",data:a})}function e(){m=0,n=[],g()}function g(){for(var a=0;a<p;a++)n[a]=[]}function h(a,b){for(var c=new Float32Array(b),d=0,e=0;e<a.length;e++)c.set(a[e],d),d+=a[e].length;return c}function i(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;e<c;)d[e++]=a[f],d[e++]=b[f],f++;return d}function j(a,b,c){for(var d=0;d<c.length;d++,b+=2){var e=Math.max(-1,Math.min(1,c[d]));a.setInt16(b,e<0?32768*e:32767*e,!0)}}function k(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}function l(a){var b=new ArrayBuffer(44+2*a.length),c=new DataView(b);return k(c,0,"RIFF"),c.setUint32(4,36+2*a.length,!0),k(c,8,"WAVE"),k(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,p,!0),c.setUint32(24,o,!0),c.setUint32(28,4*o,!0),c.setUint16(32,2*p,!0),c.setUint16(34,16,!0),k(c,36,"data"),c.setUint32(40,2*a.length,!0),j(c,44,a),c}var m=0,n=[],o=void 0,p=void 0;f.onmessage=function(f){switch(f.data.command){case"init":a(f.data.config);break;case"record":b(f.data.buffer);break;case"exportWAV":c(f.data.type);break;case"getBuffer":d();break;case"clear":e()}}},f),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=function(a){var b=d.callbacks[a.data.command].pop();"function"==typeof b&&b(a.data.data)}}return f(a,[{key:"record",value:function(){this.recording=!0}},{key:"stop",value:function(){this.recording=!1}},{key:"clear",value:function(){this.worker.postMessage({command:"clear"})}},{key:"getBuffer",value:function(a){if(a=a||this.config.callback,!a)throw new Error("Callback not set");this.callbacks.getBuffer.push(a),this.worker.postMessage({command:"getBuffer"})}},{key:"exportWAV",value:function(a,b){if(b=b||this.config.mimeType,a=a||this.config.callback,!a)throw new Error("Callback not set");this.callbacks.exportWAV.push(a),this.worker.postMessage({command:"exportWAV",type:b})}}],[{key:"forceDownload",value:function(a,b){var c=(window.URL||window.webkitURL).createObjectURL(a),d=window.document.createElement("a");d.href=c,d.download=b||"output.wav";var e=document.createEvent("Event");e.initEvent("click",!0,!0),d.dispatchEvent(e)}}]),a}();c.default=i},{"inline-worker":3}],3:[function(a,b,c){b.exports=a("./inline-worker")},{"./inline-worker":4}],4:[function(a,b,c){(function(a){var c=function(){function a(a,b){for(var c in b){var d=b[c];d.configurable=!0,d.value&&(d.writable=!0)}Object.defineProperties(a,b)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},e=!!(a===a.window&&a.URL&&a.Blob&&a.Worker),f=function(){function b(c,f){var g=this;if(d(this,b),e){var h=c.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],i=a.URL.createObjectURL(new a.Blob([h],{type:"text/javascript"}));return new a.Worker(i)}this.self=f,this.self.postMessage=function(a){setTimeout(function(){g.onmessage({data:a})},0)},setTimeout(function(){c.call(f)},0)}return c(b,{postMessage:{value:function(a){var b=this;setTimeout(function(){b.self.onmessage({data:a})},0)}}}),b}();b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
//# sourceMappingURL=recorder.min.js.map
/*! 康美网络医院 最后修改于： 2016-10-17 */